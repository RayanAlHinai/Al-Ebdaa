<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>بوابة الإبداع</title>
<link rel="stylesheet" href="style.css">
<style>
body { font-family: Tahoma, sans-serif; margin:0; padding:0; }
.news-slider { display:flex; flex-wrap:wrap; gap:10px; margin-top:10px; }
.news-card { border:1px solid #ccc; padding:10px; border-radius:5px; width:200px; }
.news-card img { width:100%; height:auto; margin-bottom:5px; }
</style>
</head>
<body>

<header>
  <img src="assets/logo2.png" alt="Left Logo" class="logo-left">
  <img src="assets/logo1.png" alt="Right Logo" class="logo-right">
  <h1>بوابة الإبداع</h1>
  <p>منصة المدرسة لعرض المواهب والإنجازات</p>
</header>

<nav>
  <a href="talents.html">المواهب</a>
  <a href="parents.html">همسات لولي الأمر</a>
  <a href="rules.html">قوانين اللائحة</a>
  <a href="library.html">المكتبة الإلكترونية</a>
  <a href="achievements.html">إنجازات المدرسة</a>
</nav>

<section class="main-bg">
  <div class="overlay">
    <div class="intro">
      <h2>أهلاً بكم في بوابة الإبداع</h2>
    </div>

    <h2>📰 الأخبار</h2>
    <div class="news-slider" id="newsContainer"></div>
  </div>
</section>

<footer>
<p>© 2025 بوابة الإبداع - جميع الحقوق محفوظة</p>
</footer>

<script>
const NEWS_KEY = "bawabatalibda3_news";
const newsContainer = document.getElementById("newsContainer");

let newsData = JSON.parse(localStorage.getItem(NEWS_KEY) || "[]");

// Render news
function renderNews() {
  newsContainer.innerHTML = "";
  newsData.forEach(news => {
    const card = document.createElement("div");
    card.className = "news-card";

    let imgTag = news.image ? `<img src="${news.image}" alt="صورة الخبر">` : "";
    card.innerHTML = `${imgTag}<h3>${news.title}</h3><p>${news.content}</p>`;
    newsContainer.appendChild(card);
  });
}

function saveNews() {
  localStorage.setItem(NEWS_KEY, JSON.stringify(newsData));
}

// Example of adding news programmatically
// newsData.push({title:"عنوان الخبر", content:"محتوى الخبر", image:"assets/news1.jpg"});
// saveNews();
// renderNews();

renderNews();
</script>

<!-- Firebase Module -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
import { getFirestore, collection, onSnapshot } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";
import { getStorage, ref, getDownloadURL } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-storage.js";

const firebaseConfig = {
  apiKey: "AIzaSyDVxMQoTpXZH4GhqlXA7W3LKmQAlF78Vp8",
  authDomain: "alebdaa3-934f1.firebaseapp.com",
  projectId: "alebdaa3-934f1",
  storageBucket: "alebdaa3-934f1.appspot.com",
  messagingSenderId: "847563462029",
  appId: "1:847563462029:web:0938bbc4677cdfe44899c4"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const storage = getStorage(app);

// Real-time news update
document.addEventListener("DOMContentLoaded", () => {
  onSnapshot(collection(db,"news"), snapshot => {
    snapshot.forEach(async doc => {
      const data = doc.data();
      const exists = Array.from(newsContainer.children).some(c => c.querySelector('h3')?.textContent === data.title);
      if(!exists){
        let imgTag = "";
        if(data.image){
          try {
            imgTag = `<img src="${await getDownloadURL(ref(storage, "news/" + data.image))}" alt="صورة الخبر">`;
          } catch(e) { console.log("Error loading image:", e); }
        }
        const card = document.createElement("div");
        card.className = "news-card";
        card.innerHTML = `${imgTag}<h3>${data.title}</h3>`;
        newsContainer.appendChild(card);
      }
    });
  });
});
</script>

</body>
</html>
