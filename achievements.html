<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>إنجازات المدرسة</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .small-btn { padding:5px 10px; border-radius:5px; cursor:pointer; }
    #editAchievementsForm { display:none; margin-top:10px; }
    #editAchievementsForm input, #editAchievementsForm textarea {
      width: 80%; padding:5px; margin-bottom:5px; display:block;
    }
    #achievementsContent { display:flex; flex-wrap:wrap; gap:10px; margin-top:10px; }
    .card { padding:10px; border:1px solid #ccc; border-radius:5px; position:relative; width:200px; }
    .card img { width:100%; height:auto; margin-top:5px; }
    .remove-btn { position:absolute; top:5px; left:5px; cursor:pointer; color:red; font-weight:bold; }
  </style>
</head>
<body>
  <header>
    <img src="assets/logo2.png" alt="Left Logo" class="logo-left">
    <img src="assets/logo1.png" alt="Right Logo" class="logo-right">
    <h1>🏆 إنجازات المدرسة</h1>
  </header>

  <nav>
    <a href="index.html">الرئيسية</a>
    <a href="talents.html">المواهب</a>
    <a href="parents.html">همسات لولي الأمر</a>
    <a href="rules.html">قوانين اللائحة</a>
    <a href="library.html">المكتبة الإلكترونية</a>
  </nav>

  <section>
    <h2 style="display:flex; justify-content:space-between; align-items:center;">
      نجاحاتنا
      <button id="editAchievementsBtn" class="small-btn">✏️ تعديل المحتوى</button>
    </h2>

    <div id="achievementsContent"></div>

    <!-- Achievements edit form -->
    <div id="editAchievementsForm">
      <input type="text" id="ach-title" placeholder="عنوان الإنجاز">
      <textarea id="ach-content" placeholder="وصف الإنجاز"></textarea>
      <input type="file" id="ach-file" accept="image/*">
      <button type="button" id="saveAchievementsBtn">📤 رفع وإضافة الإنجاز</button>
    </div>
  </section>

  <footer>
    <p>© 2025 بوابة الإبداع</p>
  </footer>

  <!-- LocalStorage Achievements Script -->
  <script>
    const ADMIN_PASS = "Admin_2002";
    const ACHIEVEMENTS_KEY = "bawabatalibda3_achievements";

    const achievementsContent = document.getElementById("achievementsContent");
    const editBtn = document.getElementById("editAchievementsBtn");
    const editForm = document.getElementById("editAchievementsForm");
    const titleInput = document.getElementById("ach-title");
    const contentInput = document.getElementById("ach-content");
    const imageInput = document.getElementById("ach-file");
    const saveBtn = document.getElementById("saveAchievementsBtn");

    let achievements = JSON.parse(localStorage.getItem(ACHIEVEMENTS_KEY) || "[]");

    function renderAchievements() {
      achievementsContent.innerHTML = "";
      achievements.forEach((ach, i) => {
        const div = document.createElement("div");
        div.className = "card";
        div.innerHTML = `<strong>${ach.title}</strong><p>${ach.content}</p>`;
        if (ach.image) {
          const img = document.createElement("img");
          img.src = ach.image;
          div.appendChild(img);
        }

        // Delete button only visible when form is open
        if (editForm.style.display === "block") {
          const delBtn = document.createElement("span");
          delBtn.textContent = "🗑";
          delBtn.className = "remove-btn";
          delBtn.onclick = () => {
            achievements.splice(i, 1);
            saveAchievements();
            renderAchievements();
          };
          div.appendChild(delBtn);
        }

        achievementsContent.appendChild(div);
      });
    }

    function saveAchievements() {
      localStorage.setItem(ACHIEVEMENTS_KEY, JSON.stringify(achievements));
    }

    editBtn.addEventListener("click", () => {
      const pass = prompt("أدخل كلمة المرور للتعديل:");
      if (pass !== ADMIN_PASS) return alert("كلمة المرور غير صحيحة ❌");
      editForm.style.display = "block";
      renderAchievements();
    });

    saveBtn.addEventListener("click", () => {
      const title = titleInput.value.trim();
      const content = contentInput.value.trim();
      if (!title || !content) return alert("الرجاء إدخال عنوان ووصف الإنجاز");

      if (imageInput.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
          achievements.push({ title, content, image: e.target.result });
          titleInput.value = "";
          contentInput.value = "";
          imageInput.value = "";
          saveAchievements();
          renderAchievements();
        };
        reader.readAsDataURL(imageInput.files[0]);
      } else {
        achievements.push({ title, content });
        titleInput.value = "";
        contentInput.value = "";
        saveAchievements();
        renderAchievements();
      }
    });

    // Initial render
    renderAchievements();
  </script>

  <!-- Firebase Module Script -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";
    import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-storage.js";

    const FIREBASE_ADMIN_PASS = "SuperSecret123";

    const firebaseConfig = {
      apiKey: "AIzaSyDVxMQoTpXZH4GhqlXA7W3LKmQAlF78Vp8",
      authDomain: "alebdaa3-934f1.firebaseapp.com",
      projectId: "alebdaa3-934f1",
      storageBucket: "alebdaa3-934f1.appspot.com",
      messagingSenderId: "847563462029",
      appId: "1:847563462029:web:0938bbc4677cdfe44899c4"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const storage = getStorage(app);

    // Example: Add achievement to Firebase
    window.addAchievementFirebase = async function() {
      const pass = prompt("Enter admin password:");
      if (pass !== FIREBASE_ADMIN_PASS) return alert("Wrong password!");
      const title = document.getElementById("ach-title").value.trim();
      const file = document.getElementById("ach-file").files[0];
      if (!title || !file) return alert("Please enter title and select image.");

      const storageRef = ref(storage, "achievements/" + file.name);
      await uploadBytes(storageRef, file);
      const url = await getDownloadURL(storageRef);

      await addDoc(collection(db, "achievements"), { title, image: url });

      document.getElementById("ach-title").value = "";
      document.getElementById("ach-file").value = "";
    };

    // Subscribe to realtime Firebase updates
    document.addEventListener("DOMContentLoaded", () => {
      const achList = document.getElementById("achievementsContent"); // Render in same div
      onSnapshot(collection(db, "achievements"), snapshot => {
        snapshot.forEach(doc => {
          const data = doc.data();
          const exists = Array.from(achList.children).some(c => c.querySelector('strong')?.textContent === data.title);
          if (!exists) {
            const div = document.createElement("div");
            div.className = "card";
            div.innerHTML = `<strong>${data.title}</strong><img src="${data.image}" />`;
            achList.appendChild(div);
          }
        });
      });
    });
  </script>

</body>
</html>
